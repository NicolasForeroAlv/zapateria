<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Carrito - Zapatos Urbanos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color:#0d6efd;">
      <div class="container">
        <a class="navbar-brand" href="index.html">Zapatos Urbanos</a>
      </div>
    </nav>

    <main class="container my-4">
      <h1>Carrito</h1>
      <div id="cartItems" class="mt-4"></div>
      <div class="mt-4">
        <button id="refresh" class="btn btn-secondary">Refrescar</button>
        <button id="getTotal" class="btn btn-primary">Calcular total</button>
        <div id="total" class="mt-3"></div>
      </div>
    </main>

    <script>
      async function loadCart(){
        const res = await fetch('/api/cart');
        const cart = await res.json();
        const container = document.getElementById('cartItems');
        container.innerHTML = '';
        if(!cart.length) {
          container.innerHTML = '<div class="alert alert-info">El carrito está vacío.</div>';
          return;
        }
        cart.forEach(item=>{
          const el = document.createElement('div');
          el.className = 'card mb-2 p-2';
          el.innerHTML = `<div><strong>${item.name}</strong> - Cantidad: ${item.quantity} - Precio: ${new Intl.NumberFormat('es-CO',{style:'currency',currency:'COP'}).format(item.price)}</div>`;
          container.appendChild(el);
        });
      }
      document.getElementById('refresh').addEventListener('click', loadCart);
      document.getElementById('getTotal').addEventListener('click', async ()=>{
        const res = await fetch('/api/cart/total');
        const json = await res.json();
        document.getElementById('total').innerHTML = '<h4>Total: ' + new Intl.NumberFormat('es-CO',{style:'currency',currency:'COP'}).format(json.total) + '</h4>';
      });
      loadCart();
    </script>
  </body>
</html>